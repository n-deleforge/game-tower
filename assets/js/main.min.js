function launcher(){get("#startScreen").style.display="flex",get("#displayTip").innerHTML=CONTENT.tips[rand(0,CONTENT.tips.length)],null!=game.core.name&&""!=game.core.name?get("#nameHero").value=game.core.name:(get("#nameHero").value="",get("#nameHero").focus()),get("#startGame").addEventListener("click",function(){get("#nameHero").checkValidity()&&""!=get("#nameHero").value?startGame("new"):(get("#nameHeroLabel").innerHTML=CONTENT.app.nameHeroCheck,get("#nameHeroLabel").style.color=getVariableCSS("--errorTextColor"))})}function startGame(e){get("#startScreen").style.display="none",get("#gameScreen").style.display="flex",changeDisplay("classic"),createMenu(),createButtons(),displayGame(),refreshDisplay=setInterval(displayGame,100),"new"==e?(1==game.core.sound&&get("#soundRoom").play(),game.core.name=get("#nameHero").value,game.core.ongoing=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.start+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.startGame_part1+".</p>",get("#gameContent").innerHTML+="<em>"+CONTENT.app.startGame_part2+".</em>",get("#gameContent").innerHTML+="<p>"+CONTENT.app.startGame_part3+".</p>"):"load"==e&&(get("#gameContent").innerHTML=game.events.currentEvent,"fight"==game.events.lastAction&&"fightOver"!=game.events.subAction&&changeDisplay("gameToFight"),"chest"==game.events.lastAction&&"chestOver"!=game.events.subAction&&changeDisplay("gameToChest"))}function play(){game.events.subAction=null,game.character.room++,changeDisplay("displayMessage"),game.character.room>10?(1==game.core.sound&&get("#soundFloor").play(),timeDisplay=2e3,game.character.room=1,game.character.floor++,game.character.floor>game.stats.bestFloor&&(game.stats.bestFloor=game.character.floor),get("#gameMessage").innerHTML='<p class="bigger">'+CONTENT.app.floor+" "+game.character.floor+"</p>"):(1==game.core.sound&&get("#soundRoom").play(),timeDisplay=1e3,game.stats.totalRoom++,get("#gameMessage").innerHTML='<p class="bigger">'+CONTENT.app.floor+" "+parseInt(game.character.floor)+"</p>",get("#gameMessage").innerHTML+="<p>"+CONTENT.app.room+" "+game.character.room+"</p>"),setTimeout(function(){changeDisplay("hideMessage")},timeDisplay),choiceAction()}function choiceAction(){let e=rand(1,9);e>7?(game.events.newAction="spirit",game.events.newAction!=game.events.lastAction?spirit():choiceAction()):e>4?(game.events.newAction="fight",game.events.newAction!=game.events.lastAction?fight():choiceAction()):e>2?(game.events.newAction="chest",game.events.newAction!=game.events.lastAction?chest():choiceAction()):(game.events.newAction="noEvent",game.events.newAction!=game.events.lastAction?noEvent():choiceAction())}function heal(){game.character.itemHeal>0&&game.character.health<game.character.healthMax&&(1==game.core.sound&&get("#soundHeal").play(),game.character.itemHeal--,game.character.health=game.character.healthMax,game.stats.healUsed++,get("#gameContent").innerHTML+='<hr><p class="green">'+CONTENT.app.healing+"</p>",saveContent())}function noEvent(){game.events.lastAction="noEvent",get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.noEvent+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.noEvent+".</p>",saveContent()}function spirit(){game.events.lastAction="spirit",game.stats.spiritMeet++;let e=rand(1,10);if(e>8)game.character.shield=game.character.shield+SETTINGS.data.spiritShield,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.earthSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritEarth_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.spiritEarth_part2+" <strong>"+SETTINGS.data.spiritShield+"</strong> "+plural(SETTINGS.data.spiritShield,CONTENT.app.point_singular,CONTENT.app.point_plural)+".</p>";else if(e>6){switch(get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.windSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritWind+".</p>",rand(1,3)){case 1:0!=game.character.itemHeal?(game.character.itemHeal--,get("#gameContent").innerHTML+='<p class="red">'+CONTENT.app.spiritWind_healStealing+".</p>"):get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritWind_noStealing+".</p>";break;case 2:0!=game.character.itemMagic?(game.character.itemMagic--,get("#gameContent").innerHTML+='<p class="red">'+CONTENT.app.spiritWind_magicStealing+".</p>"):get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritWind_noStealing+".</p>";break;case 3:0!=game.character.itemEscape?(game.character.itemEscape--,get("#gameContent").innerHTML+='<p class="red">'+CONTENT.app.spiritWind_escapeStealing+".</p>"):get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritWind_noStealing+".</p>"}}else if(e>4){let e=rand(parseInt(game.character.xpTo/8),parseInt(game.character.xpTo/6));game.character.xp=game.character.xp+e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.lightSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritLight_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.spiritLight_part2+"<strong>"+e+"</strong> "+plural(e,CONTENT.app.point_singular,CONTENT.app.point_plural)+CONTENT.app.spiritLight_part3+".</p>"}else e>2?(game.character.strength=game.character.strength+SETTINGS.data.spiritStrength,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.fireSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritFire_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.spiritFire_part2+" <strong>"+SETTINGS.data.spiritStrength+"</strong> "+plural(SETTINGS.data.spiritStrength,CONTENT.app.point_singular,CONTENT.app.point_plural)+".</p>"):(game.character.healthMax=game.character.healthMax+SETTINGS.data.spiritHealth,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.waterSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.spiritWater_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.spiritWater_part2+" <strong>"+SETTINGS.data.spiritHealth+"</strong> "+plural(SETTINGS.data.spiritHealth,CONTENT.app.point_singular,CONTENT.app.point_plural)+".</p>");saveContent()}function chest(){game.events.lastAction="chest",changeDisplay("gameToChest"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.chest+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.chest+" !</p>",saveContent()}function openChest(){1==game.core.sound&&get("#soundChest").play(),game.events.subAction="chestOver",game.stats.chestOpen++;let e=rand(0,10),a=!1;if(changeDisplay("chestToGame"),e>7){game.stats.chestTrap++;let e=rand(1,game.character.health/4);game.character.health=game.character.health-e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.chestTrap+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestTrap_part1+" !</p>",get("#gameContent").innerHTML+='<p class="red">'+CONTENT.app.chestTrap_part2+"<strong>"+e+"</strong> "+plural(e,CONTENT.app.point_singular,CONTENT.app.point_plural)+CONTENT.app.chestTrap_part3+".</p>"}else e>5?(SETTINGS.data.itemLimit>game.character.itemEscape?game.character.itemEscape++:a=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.chestEscape+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestEscape+".</p>",a&&(get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestLimit+".</p>")):e>3?(SETTINGS.data.itemLimit>game.character.itemMagic?game.character.itemMagic++:a=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.chestMagic+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestMagic+".</p>",a&&(get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestLimit+".</p>")):(SETTINGS.data.itemLimit>game.character.itemHeal?game.character.itemHeal++:a=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.chestHeal+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestHeal+".</p>",a&&(get("#gameContent").innerHTML+="<p>"+CONTENT.app.chestLimit+".</p>"));saveContent()}function closeChest(){game.stats.chestNotOpened++,game.events.subAction="chestOver",changeDisplay("chestToGame"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+SETTINGS.images.chest+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.chest+" !</p>",get("#gameContent").innerHTML+="<p>"+CONTENT.app.chest_notOpened+".</p>",saveContent()}function fight(){game.events.lastAction="fight",game.events.monster=choiceMonster(),changeDisplay("gameToFight"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+CONTENT.app.fightStart+"</p>",get("#gameContent").innerHTML+="<p>"+CONTENT.app.health+" : <strong>"+game.events.monster[0]+"</strong> / "+CONTENT.app.strength+" : <strong>"+game.events.monster[1]+"</strong></p>",saveContent()}function choiceMonster(){let e=rand(2*game.character.floor,4*game.character.floor);return e>500?[e,parseInt(e/3),CONTENT.monsters.dragon,SETTINGS.images.monster17]:e>450?[e,parseInt(e/3),CONTENT.monsters.supDemon,SETTINGS.images.monster16]:e>400?[e,parseInt(e/3),CONTENT.monsters.bigSpirit,SETTINGS.images.monster15]:e>350?[e,parseInt(e/3),CONTENT.monsters.deadWarrior,SETTINGS.images.monster14]:e>290?[e,parseInt(e/3),CONTENT.monsters.troll,SETTINGS.images.monster13]:e>240?[e,parseInt(e/3),CONTENT.monsters.behemot,SETTINGS.images.monster12]:e>190?[e,parseInt(e/3),CONTENT.monsters.minotaur,SETTINGS.images.monster11]:e>160?[e,parseInt(e/3),CONTENT.monsters.cerberus,SETTINGS.images.monster10]:e>130?[e,parseInt(e/3),CONTENT.monsters.goblin,SETTINGS.images.monster09]:e>100?[e,parseInt(e/3),CONTENT.monsters.ghost,SETTINGS.images.monster08]:e>75?[e,parseInt(e/3),CONTENT.monsters.cockatrice,SETTINGS.images.monster07]:e>50?[e,parseInt(e/3),CONTENT.monsters.lamia,SETTINGS.images.monster06]:e>40?[e,parseInt(e/3),CONTENT.monsters.imp,SETTINGS.images.monster05]:e>30?[e,parseInt(e/3),CONTENT.monsters.plant,SETTINGS.images.monster04]:e>20?[e,parseInt(e/3),CONTENT.monsters.scorpio,SETTINGS.images.monster03]:e>10?[e,parseInt(e/3),CONTENT.monsters.spider,SETTINGS.images.monster02]:[e,parseInt(e/3),CONTENT.monsters.slim,SETTINGS.images.monster01]}function attack(){1==game.core.sound&&get("#soundAttack").play(),game.stats.fightVictory++,game.events.subAction="fightOver",changeDisplay("fightToGame");let e=Math.ceil(game.events.monster[0]/game.character.strength),a=parseInt(e*game.events.monster[1]-parseInt(game.events.monster[1])/e)-game.character.shield;1==e&&(a=0),a<0&&(a=0),game.character.health=game.character.health-a;let t=rand(game.character.level*game.events.monster[0],game.character.level*game.events.monster[0]*2);game.character.xp=game.character.xp+t,game.stats.totalExp=game.stats.totalExp+t,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+CONTENT.app.fightWin_part1+"<strong>"+e+"</strong> "+plural(e,CONTENT.app.hit_singular,CONTENT.app.hit_plural)+" !</p>",get("#gameContent").innerHTML+='<p class="red">'+CONTENT.app.fightWin_part2+"<strong>"+a+"</strong> "+plural(a,CONTENT.app.point_singular,CONTENT.app.point_plural)+" "+CONTENT.app.fightWin_part3+".</p>",game.character.health>0&&(get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.fightWin_part5+"<strong>"+t+"</strong> "+plural(t,CONTENT.app.point_singular,CONTENT.app.point_plural)+CONTENT.app.fightWin_part4+".</p>"),saveContent()}function magic(){if(game.character.itemMagic>0){1==game.core.sound&&get("#soundMagic").play(),game.stats.fightVictory++,game.events.subAction="fightOver",game.character.itemMagic--,changeDisplay("fightToGame");let e=rand(parseInt(game.character.level*game.events.monster[0]/2),game.character.level*game.events.monster[0]);game.character.xp=game.character.xp+e,game.stats.totalExp=game.stats.totalExp+e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.fightMagic+".</p>",get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.fightWin_part5+"<strong>"+e+"</strong> "+plural(e,CONTENT.app.point_singular,CONTENT.app.point_plural)+CONTENT.app.fightWin_part4+".</p>",saveContent()}}function runAway(){game.character.itemEscape>0&&(1==game.core.sound&&get("#soundEscape").play(),game.stats.fightEscape++,game.character.itemEscape--,changeDisplay("fightToGame"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p>"+CONTENT.app.fightEscape+".</p>",saveContent())}function displayGame(){game.character.health<1?gameOver():(checkExperience(),checkInfo(),checkItems(),checkScore(),storage("set","TOWER-gameSettings",JSON.stringify(game)))}function gameOver(){clearInterval(refreshDisplay),changeDisplay("classic"),get("#move").removeEventListener("click",play),get("#move").addEventListener("click",displayScore),get("#move").innerHTML=CONTENT.app.results,get("#useHeal").style.display="none",get("#gameContent").innerHTML+='<p class="red"><strong>'+CONTENT.app.death+"</strong></p>"}function displayScore(){if(get("#gameMessage").style.backgroundColor=getVariableCSS("--gameoverBackground"),resetData(),changeDisplay("displayMessage"),get("#gameMessage").innerHTML='<p class="bigger">'+CONTENT.app.gameover+game.character.score+" pts.</p>",get("#gameMessage").innerHTML+='<button id="restart">'+CONTENT.app.gameoverButton+"</button>",get("#restart").addEventListener("click",function(){location.reload()}),navigator.share){get("#gameMessage").innerHTML+='<button id="share">'+CONTENT.app.shareScore_button+"</button>";const e={text:CONTENT.app.shareScore_part1+game.character.score+CONTENT.app.shareScore_part2,url:"https://nicolas-deleforge/apps/tower/"};get("#share").addEventListener("click",function(){navigator.share(e)})}}function changeDisplay(e){"classic"==e&&(get(".listActionsLine")[1].style.display="none",get(".listActionsLine")[2].style.display="none"),"gameToChest"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[1].style.display="flex"),"chestToGame"==e&&(get(".listActionsLine")[0].style.display="flex",get(".listActionsLine")[1].style.display="none"),"gameToFight"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[2].style.display="flex"),"fightToGame"==e&&(get(".listActionsLine")[0].style.display="flex",get(".listActionsLine")[2].style.display="none"),"displayMessage"==e&&(get("~header").style.display="none",get("#gameScreen").style.display="none",get("#gameMessage").style.display="flex"),"hideMessage"==e&&(get("~header").style.display="flex",get("#gameScreen").style.display="flex",get("#gameMessage").style.display="none")}function checkInfo(){get("#name").innerHTML='<img src="assets/images/'+SETTINGS.images.iconHero+'" alt=""> '+game.core.name+" ("+CONTENT.app.level+" "+game.character.level+")",get("#health").innerHTML='<img src="assets/images/'+SETTINGS.images.iconHealth+'" alt=""> '+CONTENT.app.health+" "+game.character.health+" / "+game.character.healthMax,get("#xp").innerHTML='<img src="assets/images/'+SETTINGS.images.iconExperience+'" alt=""> '+CONTENT.app.experience+" "+game.character.xp+" / "+game.character.xpTo,get("#strength").innerHTML='<img src="assets/images/'+SETTINGS.images.iconStrength+'" alt="">  '+CONTENT.app.strength+" "+game.character.strength,get("#shield").innerHTML='<img src="assets/images/'+SETTINGS.images.iconShield+'" alt="">  '+CONTENT.app.shield+" "+game.character.shield,get("#headerTitle").innerHTML=CONTENT.app.floor+" "+game.character.floor+" - "+CONTENT.app.room+" "+game.character.room}function checkItems(){game.character.itemHeal<1||game.character.health==game.character.healthMax?get("#useHeal").disabled=!0:get("#useHeal").disabled=!1,game.character.itemMagic>0?get("#useMagic").disabled=!1:get("#useMagic").disabled=!0,game.character.itemEscape>0?get("#useEscape").disabled=!1:get("#useEscape").disabled=!0,get("#potion").innerHTML='<img src="assets/images/'+SETTINGS.images.iconPotion+'" alt=""> '+game.character.itemHeal+" "+plural(game.character.itemHeal,CONTENT.app.heal_singular,CONTENT.app.heal_plural),get("#magic").innerHTML='<img src="assets/images/'+SETTINGS.images.iconMagic+'" alt=""> '+game.character.itemMagic+" "+plural(game.character.itemMagic,CONTENT.app.magic_singular,CONTENT.app.magic_plural),get("#escape").innerHTML='<img src="assets/images/'+SETTINGS.images.iconEscape+'"alt=""> '+game.character.itemEscape+" "+plural(game.character.itemEscape,CONTENT.app.escape_singular,CONTENT.app.escape_plural)}function checkExperience(){game.character.xp>=game.character.xpTo&&(game.character.level++,game.character.level>game.stats.maxLevel&&(game.stats.maxLevel=game.character.level),game.character.strength=game.character.strength+SETTINGS.data.lvlUpStrength,game.character.shield=game.character.shield+SETTINGS.data.lvlUpShield,game.character.healthMax=game.character.healthMax+SETTINGS.data.lvlUpealth,game.character.health=game.character.healthMax,game.character.xp=0,game.character.xpTo=rand(parseInt(1.5*game.character.xpTo),2*game.character.xpTo),get("#gameContent").innerHTML+='<hr><p class="green">'+CONTENT.app.levelUp_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+CONTENT.app.levelUp_part2+".</p>",saveContent())}function checkScore(){game.character.score=(game.character.strength+game.character.healthMax)*game.character.level*game.character.floor-30,game.character.score>game.stats.bestScore&&(game.stats.bestScore=game.character.score)}function checkSound(){1==game.core.sound?(game.core.sound=!1,get("#volumeButton").innerHTML="🔈"):(game.core.sound=!0,get("#volumeButton").innerHTML="🔊")}function createMenu(){get("#optionButton").addEventListener("click",function(){get("#containerPopup").style.display="flex",get("#optionMenu").style.display="block",get("#closeOptionMenu").addEventListener("click",function(){get("#containerPopup").style.display="none",get("#optionMenu").style.display="none"})}),get("#openStatsMenu").addEventListener("click",function(){let e=Object.values(CONTENT.stats),a=Object.values(game.stats);for(let t=0;t<e.length;t++)0==t?get("#listStats").innerHTML="<li>"+e[t]+a[t]+"</li>":get("#listStats").innerHTML+="<li>"+e[t]+a[t]+"</li>";get("#optionMenu").style.display="none",get("#statsMenu").style.display="block",get("#closeStatsMenu").addEventListener("click",function(){get("#containerPopup").style.display="none",get("#statsMenu").style.display="none"})}),get("#openInfoMenu").addEventListener("click",function(){get("#optionMenu").style.display="none",get("#infoMenu").style.display="block",get("#closeInfoMenu").addEventListener("click",function(){get("#containerPopup").style.display="none",get("#infoMenu").style.display="none"})}),get("#confirmRestart").addEventListener("click",function(){clearInterval(refreshDisplay),game.core.ongoing=!1,resetData(),location.reload()}),get("#confirmTotalRestart").addEventListener("click",function(){clearInterval(refreshDisplay),storage("rem","TOWER-gameSettings"),location.reload()})}function createButtons(){get("#optionButton").style.visibility="visible",get("#volumeButton").style.visibility="visible",get("#volumeButton").addEventListener("click",checkSound),1==game.core.sound?get("#volumeButton").innerHTML="🔊":get("#volumeButton").innerHTML="🔈",get("#move").addEventListener("click",play),get("#useHeal").addEventListener("click",heal),get("#openChest").addEventListener("click",openChest),get("#closeChest").addEventListener("click",closeChest),get("#useAttack").addEventListener("click",attack),get("#useMagic").addEventListener("click",magic),get("#useEscape").addEventListener("click",runAway)}function resetData(){game.core.ongoing=!1,game.stats.totalGame++,game.character.health=SETTINGS.data.health,game.character.healthMax=SETTINGS.data.healthMax,game.character.strength=SETTINGS.data.strength,game.character.shield=SETTINGS.data.shield,game.character.xp=SETTINGS.data.xp,game.character.xpTo=SETTINGS.data.xpTo,game.character.itemHeal=SETTINGS.data.heal,game.character.itemMagic=SETTINGS.data.magic,game.character.itemEscape=SETTINGS.data.escape,game.character.level=SETTINGS.data.level,game.character.floor=SETTINGS.data.floor,game.character.room=SETTINGS.data.room,storage("set","TOWER-gameSettings",JSON.stringify(game))}function saveContent(){game.events.currentEvent=get("#gameContent").innerHTML}0==game.core.ongoing?launcher():startGame("load");