function startGame(e){get("#startScreen").style.display="none",get("#gameScreen").style.display="flex",changeDisplay("classic"),displayGame(),settings.refreshDisplay=setInterval(displayGame,100),get("#optionButton").style.visibility="visible",get("#volumeButton").style.visibility="visible",get("#volumeButton").addEventListener("click",checkSound),1==game.core.sound?get("#volumeButton").innerHTML="🔊":get("#volumeButton").innerHTML="🔈",get("#optionButton").addEventListener("click",function(){get("#containerPopup").style.display="flex",get("#optionMenu").style.display="block",get("#closeOptionMenu").addEventListener("click",function(){get("#containerPopup").style.display="none",get("#optionMenu").style.display="none"})}),get("#openStatsMenu").addEventListener("click",function(){let e=Object.values(language.stats),a=Object.values(game.stats);for(let t=0;t<e.length;t++)0==t?get("#listStats").innerHTML="<li>"+e[t]+a[t]+"</li>":get("#listStats").innerHTML+="<li>"+e[t]+a[t]+"</li>";get("#optionMenu").style.display="none",get("#statsMenu").style.display="block",get("#closeStatsMenu").addEventListener("click",function(){get("#containerPopup").style.display="none",get("#statsMenu").style.display="none"})}),get("#openInfoMenu").addEventListener("click",function(){get("#optionMenu").style.display="none",get("#infoMenu").style.display="block",get("#closeInfoMenu").addEventListener("click",function(){get("#containerPopup").style.display="none",get("#infoMenu").style.display="none"})}),get("#confirmRestart").addEventListener("click",function(){clearInterval(settings.refreshDisplay),game.core.ongoing=!1,resetData(),location.reload()}),get("#confirmTotalRestart").addEventListener("click",function(){clearInterval(settings.refreshDisplay),storage("rem","TOWER-gameSettings"),location.reload()}),get("#move").addEventListener("click",play),get("#useHeal").addEventListener("click",heal),get("#openChest").addEventListener("click",openChest),get("#closeChest").addEventListener("click",closeChest),get("#useAttack").addEventListener("click",attack),get("#useMagic").addEventListener("click",magic),get("#useEscape").addEventListener("click",runAway),"new"==e&&(get("#gameContent").innerHTML=language.app.startGame,game.core.name=get("#nameHero").value,1==game.core.sound&&get("#soundRoom").play()),"load"==e&&(get("#gameContent").innerHTML=game.events.currentEvent,"fight"==game.events.lastAction&&"fightOver"!=game.events.subAction&&changeDisplay("gameToFight"),"bossFight"==game.events.lastAction&&"fightOver"!=game.events.subAction&&changeDisplay("gameToBossFight"),"chest"==game.events.lastAction&&"chestOver"!=game.events.subAction&&changeDisplay("gameToChest"))}function play(){game.core.ongoing=!0,game.events.subAction=null,game.character.room++,changeDisplay("displayMessage"),game.character.room>10?(1==game.core.sound&&get("#soundFloor").play(),settings.messageTimeDisplay=2e3,game.character.room=1,game.character.floor++,game.character.floor>game.stats.bestFloor&&(game.stats.bestFloor=game.character.floor),get("#gameMessage").innerHTML='<p class="bigger">'+language.app.floor+" "+game.character.floor+"</p>"):(1==game.core.sound&&get("#soundRoom").play(),settings.messageTimeDisplay=1e3,game.stats.totalRoom++,get("#gameMessage").innerHTML='<p class="bigger">'+language.app.floor+" "+parseInt(game.character.floor)+"</p>",get("#gameMessage").innerHTML+="<p>"+language.app.room+" "+game.character.room+"</p>"),setTimeout(function(){changeDisplay("hideMessage")},settings.messageTimeDisplay),-1!=settings.floorSpecial.indexOf(game.character.floor)&&1==game.character.room?specialEvent():-1!=settings.floorBoss.indexOf(game.character.floor)&&10==game.character.room?(1==game.core.sound&&get("#soundBossFight").play(),fight("bossFight")):choiceAction()}function choiceAction(){let e=rand(1,9);e>7?(game.events.newAction="spirit",game.events.newAction!=game.events.lastAction?spirit():choiceAction()):e>4?(game.events.newAction="fight",game.events.newAction!=game.events.lastAction?fight():choiceAction()):e>2?(game.events.newAction="chest",game.events.newAction!=game.events.lastAction?chest():choiceAction()):(game.events.newAction="noEvent",game.events.newAction!=game.events.lastAction?noEvent():choiceAction())}function heal(){game.character.itemHeal>0&&game.character.health<game.character.healthMax&&(1==game.core.sound&&get("#soundHeal").play(),game.character.itemHeal--,game.character.health=game.character.healthMax,game.stats.healUsed++,get("#gameContent").innerHTML+='<hr><p class="green">'+language.app.healing+"</p>",saveContent())}function noEvent(){game.events.lastAction="noEvent",get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/noEvent.png" alt=""></div><p>'+language.app.noEvent+".</p>",saveContent()}function spirit(){game.events.lastAction="spirit",game.stats.spiritMeet++;let e=rand(1,10);if(e>8)game.character.shield=game.character.shield+settings.data.spiritShield,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/spiritEarth.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.spiritEarth_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+language.app.spiritEarth_part2+" <strong>"+settings.data.spiritShield+"</strong> "+plural(settings.data.spiritShield,language.app.point_singular,language.app.point_plural)+".</p>";else if(e>6){switch(get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/spiritWind.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.spiritWind+".</p>",rand(1,3)){case 1:0!=game.character.itemHeal?(game.character.itemHeal--,get("#gameContent").innerHTML+='<p class="red">'+language.app.spiritWind_healStealing+".</p>"):get("#gameContent").innerHTML+="<p>"+language.app.spiritWind_noStealing+".</p>";break;case 2:0!=game.character.itemMagic?(game.character.itemMagic--,get("#gameContent").innerHTML+='<p class="red">'+language.app.spiritWind_magicStealing+".</p>"):get("#gameContent").innerHTML+="<p>"+language.app.spiritWind_noStealing+".</p>";break;case 3:0!=game.character.itemEscape?(game.character.itemEscape--,get("#gameContent").innerHTML+='<p class="red">'+language.app.spiritWind_escapeStealing+".</p>"):get("#gameContent").innerHTML+="<p>"+language.app.spiritWind_noStealing+".</p>"}}else if(e>4){let e=rand(parseInt(game.character.xpTo/8),parseInt(game.character.xpTo/6));game.character.xp=game.character.xp+e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/spiritLight.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.spiritLight_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+language.app.spiritLight_part2+"<strong>"+e+"</strong> "+plural(e,language.app.point_singular,language.app.point_plural)+language.app.spiritLight_part3+".</p>"}else e>2?(game.character.strength=game.character.strength+settings.data.spiritStrength,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/spiritFire.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.spiritFire_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+language.app.spiritFire_part2+" <strong>"+settings.data.spiritStrength+"</strong> "+plural(settings.data.spiritStrength,language.app.point_singular,language.app.point_plural)+".</p>"):(game.character.healthMax=game.character.healthMax+settings.data.spiritHealth,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/spiritWater.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.spiritWater_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+language.app.spiritWater_part2+" <strong>"+settings.data.spiritHealth+"</strong> "+plural(settings.data.spiritHealth,language.app.point_singular,language.app.point_plural)+".</p>");saveContent()}function specialEvent(){game.character.floor==settings.lastFloor?gameOver():choiceAction()}function chest(){game.events.lastAction="chest",changeDisplay("gameToChest"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/chest.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.chest+" !</p>",saveContent()}function openChest(){1==game.core.sound&&get("#soundChest").play(),game.events.subAction="chestOver",game.stats.chestOpen++,changeDisplay("chestToGame");let e=rand(0,10),a=!1;if(e>7){game.stats.chestTrap++;let e=rand(1,game.character.health/4);game.character.health=game.character.health-e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/chestTrap.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.chestTrap_part1+" !</p>",get("#gameContent").innerHTML+='<p class="red">'+language.app.chestTrap_part2+"<strong>"+e+"</strong> "+plural(e,language.app.point_singular,language.app.point_plural)+language.app.chestTrap_part3+".</p>"}else e>5?(game.character.itemLimit>game.character.itemEscape?game.character.itemEscape++:a=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/chestEscape.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.chestEscape+".</p>",a&&(get("#gameContent").innerHTML+="<p>"+language.app.chestLimit+".</p>")):e>3?(game.character.itemLimit>game.character.itemMagic?game.character.itemMagic++:a=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/chestMagic.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.chestMagic+".</p>",a&&(get("#gameContent").innerHTML+="<p>"+language.app.chestLimit+".</p>")):(game.character.itemLimit>game.character.itemHeal?game.character.itemHeal++:a=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/chestHeal.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.chestHeal+".</p>",a&&(get("#gameContent").innerHTML+="<p>"+language.app.chestLimit+".</p>"));saveContent()}function closeChest(){game.stats.chestNotOpened++,game.events.subAction="chestOver",changeDisplay("chestToGame"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/events/chest.png" alt=""></div>',get("#gameContent").innerHTML+="<p>"+language.app.chest+" !</p>",get("#gameContent").innerHTML+="<p>"+language.app.chest_notOpened+".</p>",saveContent()}function fight(e){game.events.lastAction="bossFight"==e?"bossFight":"fight",game.events.monster=choiceMonster(),changeDisplay("bossFight"==e?"gameToBossFight":"gameToFight"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/monsters/'+game.events.monster[3]+'.png" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="bossFight"==e?"<p>"+language.app.bossFight_start+" !</p>":"<p><strong>"+game.events.monster[2]+"</strong> "+language.app.fightStart+"</p>",get("#gameContent").innerHTML+="<p>"+language.app.health+" : <strong>"+game.events.monster[0]+"</strong> / "+language.app.strength+" : <strong>"+game.events.monster[1]+"</strong></p>",saveContent()}function choiceMonster(){let e;return(e="bossFight"==game.events.lastAction?rand(4*game.character.floor,5*game.character.floor):rand(2*game.character.floor,4*game.character.floor))>500?[e,parseInt(e/3),language.monsters.dragon,"monster_17"]:e>450?[e,parseInt(e/3),language.monsters.supDemon,"monster_16"]:e>400?[e,parseInt(e/3),language.monsters.bigSpirit,"monster_15"]:e>350?[e,parseInt(e/3),language.monsters.deadWarrior,"monster_14"]:e>290?[e,parseInt(e/3),language.monsters.troll,"monster_13"]:e>240?[e,parseInt(e/3),language.monsters.behemot,"monster_12"]:e>190?[e,parseInt(e/3),language.monsters.minotaur,"monster_11"]:e>160?[e,parseInt(e/3),language.monsters.cerberus,"monster_10"]:e>130?[e,parseInt(e/3),language.monsters.goblin,"monster_09"]:e>100?[e,parseInt(e/3),language.monsters.ghost,"monster_08"]:e>75?[e,parseInt(e/3),language.monsters.cockatrice,"monster_07"]:e>50?[e,parseInt(e/3),language.monsters.lamia,"monster_06"]:e>40?[e,parseInt(e/3),language.monsters.imp,"monster_05"]:e>30?[e,parseInt(e/3),language.monsters.plant,"monster_04"]:e>20?[e,parseInt(e/3),language.monsters.scorpio,"monster_03"]:e>10?[e,parseInt(e/3),language.monsters.spider,"monster_02"]:[e,parseInt(e/3),language.monsters.slim,"monster_01"]}function attack(){1==game.core.sound&&get("#soundAttack").play(),game.stats.fightVictory++,game.events.subAction="fightOver",changeDisplay("fightToGame");let e=Math.ceil(game.events.monster[0]/game.character.strength),a=parseInt(e*game.events.monster[1]-parseInt(game.events.monster[1])/e)-game.character.shield;1==e&&(a=0),a<0&&(a=0),game.character.health=game.character.health-a;let t=rand(game.character.level*game.events.monster[0],game.character.level*game.events.monster[0]*2);"bossFight"==game.events.lastAction?game.character.xp=game.character.xp+5*t:game.character.xp=game.character.xp+t,game.stats.totalExp=game.stats.totalExp+t,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/monsters/'+game.events.monster[3]+'.png" alt="'+game.events.monster[2]+'"></div>',"bossFight"==game.events.lastAction?get("#gameContent").innerHTML+="<p>"+language.app.bossFight_win+"<strong>"+e+"</strong> "+plural(e,language.app.hit_singular,language.app.hit_plural)+" !</p>":get("#gameContent").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+language.app.fightWin_part1+"<strong>"+e+"</strong> "+plural(e,language.app.hit_singular,language.app.hit_plural)+" !</p>",get("#gameContent").innerHTML+='<p class="red">'+language.app.fightWin_part2+"<strong>"+a+"</strong> "+plural(a,language.app.point_singular,language.app.point_plural)+" "+language.app.fightWin_part3+".</p>",game.character.health>0&&(get("#gameContent").innerHTML+='<p class="green">'+language.app.fightWin_part5+"<strong>"+t+"</strong> "+plural(t,language.app.point_singular,language.app.point_plural)+language.app.fightWin_part4+".</p>"),saveContent()}function magic(){if("bossFight"!=game.events.lastAction&&game.character.itemMagic>0||"bossFight"==game.events.lastAction&&game.character.itemMagic>2){1==game.core.sound&&get("#soundMagic").play(),game.stats.fightVictory++,game.events.subAction="fightOver",changeDisplay("fightToGame"),"bossFight"==game.events.lastAction?game.character.itemMagic=game.character.itemMagic-3:game.character.itemMagic--;let e=rand(parseInt(game.character.level*game.events.monster[0]/2),game.character.level*game.events.monster[0]);game.character.xp=game.character.xp+e,game.stats.totalExp=game.stats.totalExp+e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/monsters/'+game.events.monster[3]+'.png"alt="'+game.events.monster[2]+'"></div>',"bossFight"==game.events.lastAction?get("#gameContent").innerHTML+="<p>"+language.app.bossFight_magic+".</p>":get("#gameContent").innerHTML+="<p>"+language.app.fightMagic+".</p>",get("#gameContent").innerHTML+='<p class="green">'+language.app.fightWin_part5+"<strong>"+e+"</strong> "+plural(e,language.app.point_singular,language.app.point_plural)+language.app.fightWin_part4+".</p>",saveContent()}}function runAway(){game.character.itemEscape>0&&(1==game.core.sound&&get("#soundEscape").play(),game.stats.fightEscape++,game.character.itemEscape--,changeDisplay("fightToGame"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/monsters/'+game.events.monster[3]+'.png" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p>"+language.app.fightEscape+".</p>",saveContent())}function displayGame(){game.character.health<1?gameOver():(checkExperience(),checkItems(),checkScore(),get("#name").innerHTML='<img src="assets/images/icons/hero.png" alt="🤺"> '+game.core.name+" ("+language.app.level+" "+game.character.level+")",get("#health").innerHTML='<img src="assets/images/icons/health.png" alt="💓"> '+language.app.health+" "+game.character.health+" / "+game.character.healthMax,get("#xp").innerHTML='<img src="assets/images/icons/xp.png" alt="🏆"> '+language.app.experience+" "+game.character.xp+" / "+game.character.xpTo,get("#strength").innerHTML='<img src="assets/images/icons/strength.png" alt="💪">  '+language.app.strength+" "+game.character.strength,get("#shield").innerHTML='<img src="assets/images/icons/shield.png" alt="🛡️">  '+language.app.shield+" "+game.character.shield,get("#headerTitle").innerHTML=language.app.floor+" "+game.character.floor+" - "+language.app.room+" "+game.character.room,storage("set","TOWER-gameSettings",JSON.stringify(game)))}function gameOver(){clearInterval(settings.refreshDisplay),changeDisplay("classic"),game.character.floor==settings.lastFloor&&(changeDisplay("hideMessage"),get("#headerTitle").innerHTML=language.app.floor+" "+settings.lastFloor),get("#move").removeEventListener("click",play),get("#move").addEventListener("click",displayScore),get("#move").innerHTML=language.app.results,get("#useHeal").style.display="none",game.character.floor==settings.lastFloor?get("#gameContent").innerHTML=language.app.endGame:get("#gameContent").innerHTML+='<p class="red"><strong>'+language.app.death+"</strong></p>"}function displayScore(){if(game.character.floor==settings.lastFloor?get("#gameMessage").style.backgroundColor="lightbluesky":get("#gameMessage").style.backgroundColor="lightcoral",resetData(),changeDisplay("displayMessage"),get("#gameMessage").innerHTML='<p class="bigger">'+language.app.gameover+game.character.score+" pts.</p>",get("#gameMessage").innerHTML+='<button id="restart">'+language.app.gameoverButton+"</button>",get("#restart").addEventListener("click",function(){location.reload()}),navigator.share){get("#gameMessage").innerHTML+='<button id="share">'+language.app.shareScore_button+"</button>";const e={text:language.app.shareScore_part1+game.character.score+language.app.shareScore_part2,url:"https://nicolas-deleforge/apps/tower/"};get("#share").addEventListener("click",function(){navigator.share(e)})}}function changeDisplay(e){"classic"==e&&(get(".listActionsLine")[1].style.display="none",get(".listActionsLine")[2].style.display="none"),"gameToChest"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[1].style.display="flex"),"chestToGame"==e&&(get(".listActionsLine")[0].style.display="flex",get(".listActionsLine")[1].style.display="none"),"gameToFight"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[2].style.display="flex"),"fightToGame"==e&&(get(".listActionsLine")[0].style.display="flex",get(".listActionsLine")[2].style.display="none"),"gameToBossFight"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[2].style.display="flex"),"bossFightToGame"==e&&(get(".listActionsLine")[2].style.display="none",get(".listActionsLine")[0].style.display="flex"),"displayMessage"==e&&(get("~header").style.display="none",get("#gameScreen").style.display="none",get("#gameMessage").style.display="flex"),"hideMessage"==e&&(get("~header").style.display="flex",get("#gameScreen").style.display="flex",get("#gameMessage").style.display="none")}function checkItems(){game.character.itemHeal<1||game.character.health==game.character.healthMax?get("#useHeal").disabled=!0:get("#useHeal").disabled=!1,"bossFight"!=game.events.lastAction&&game.character.itemMagic>0||"bossFight"==game.events.lastAction&&game.character.itemMagic>2?get("#useMagic").disabled=!1:get("#useMagic").disabled=!0,game.character.itemEscape>0&&"bossFight"!=game.events.lastAction?get("#useEscape").disabled=!1:get("#useEscape").disabled=!0,get("#potion").innerHTML='<img src="assets/images/icons/potion.png" alt="🥃"> '+game.character.itemHeal+" "+plural(game.character.itemHeal,language.app.heal_singular,language.app.heal_plural),get("#magic").innerHTML='<img src="assets/images/icons/magic.png" alt="🃏"> '+game.character.itemMagic+" "+plural(game.character.itemMagic,language.app.magic_singular,language.app.magic_plural),get("#escape").innerHTML='<img src="assets/images/icons/escape.png" alt="📜"> '+game.character.itemEscape+" "+plural(game.character.itemEscape,language.app.escape_singular,language.app.escape_plural)}function checkExperience(){game.character.xp>=game.character.xpTo&&(game.character.level++,game.character.strength=game.character.strength+game.character.lvlUpStrength,game.character.shield=game.character.shield+game.character.lvlUpShield,game.character.healthMax=game.character.healthMax+game.character.lvlUpealth,game.character.health=game.character.healthMax,game.character.xp=0,game.character.xpTo=rand(parseInt(1.5*game.character.xpTo),2*game.character.xpTo),game.character.level>game.stats.maxLevel&&(game.stats.maxLevel=game.character.level),get("#gameContent").innerHTML+='<hr><p class="green">'+language.app.levelUp_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+language.app.levelUp_part2+".</p>",saveContent())}function checkScore(){game.character.score=(game.character.strength+game.character.healthMax)*game.character.level*game.character.floor-30,game.character.score>game.stats.bestScore&&(game.stats.bestScore=game.character.score)}function checkSound(){1==game.core.sound?(game.core.sound=!1,get("#volumeButton").innerHTML="🔈"):(game.core.sound=!0,get("#volumeButton").innerHTML="🔊")}function randomTip(){let e=rand(0,language.tips.length);return language.tips[e]}function resetData(){game.core.ongoing=!1,game.stats.totalGame++,game.character.health=settings.data.health,game.character.healthMax=settings.data.healthMax,game.character.strength=settings.data.strength,game.character.shield=settings.data.shield,game.character.xp=settings.data.xp,game.character.xpTo=settings.data.xpTo,game.character.itemHeal=settings.data.heal,game.character.itemMagic=settings.data.magic,game.character.itemEscape=settings.data.escape,game.character.level=settings.data.level,game.character.floor=settings.data.floor,game.character.room=settings.data.room,game.character.itemLimit=settings.data.itemLimit,game.character.lvlUpHealth=settings.data.lvlUpHealth,game.character.lvlUpStrenght=settings.data.lvlUpStrenght,game.character.lvlUpShield=settings.data.lvlUpShield,storage("set","TOWER-gameSettings",JSON.stringify(game))}function saveContent(){game.events.currentEvent=get("#gameContent").innerHTML}0==game.core.ongoing?(get("#startScreen").style.display="flex",get("#displayTip").innerHTML=randomTip(),null!=game.core.name&&""!=game.core.name?get("#nameHero").value=game.core.name:(get("#nameHero").value="",get("#nameHero").focus()),get("#startGame").addEventListener("click",function(){get("#nameHero").checkValidity()&&""!=get("#nameHero").value?startGame("new"):(get("#nameHeroLabel").innerHTML=language.app.nameHeroCheck,get("#nameHeroLabel").style.color="red")})):startGame("load");